<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <!-- Prevent iPhone zoom -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <title>Client Dashboard - Emery Campbell</title>

    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Montserrat:wght@400;500&display=swap" rel="stylesheet">

    <style>
        body{
            margin:0;
            font-family:'Montserrat',sans-serif;
            background:#000;
            color:#fff;
            padding:40px 20px;
        }

        h1{
            font-family:'Cormorant Garamond',serif;
            margin-bottom:30px;
        }

        .card{
            background:#111;
            padding:25px;
            border-radius:12px;
            margin-bottom:20px;
        }

        .card h3{
            margin-bottom:15px;
            font-weight:500;
        }

        input, textarea{
            width:100%;
            padding:12px;
            margin-bottom:12px;
            border-radius:8px;
            border:1px solid #333;
            background:#1c1c1c;
            color:#fff;
            font-size:14px;
        }

        button{
            padding:10px 18px;
            border:none;
            background:#C19A6B;
            color:#000;
            border-radius:6px;
            cursor:pointer;
            font-weight:600;
        }

        .logout-btn{
            margin-top:20px;
            background:#8B7355;
            color:#fff;
        }

        .activity-item{
            font-size:13px;
            margin-bottom:8px;
            border-bottom:1px solid #222;
            padding-bottom:6px;
        }
    </style>
</head>
<body>

<h1>Client Dashboard</h1>

<div class="card">
    <h3>Profile Information</h3>
    <input type="text" id="nameInput" placeholder="Full Name">
    <input type="email" id="emailInput" disabled>
    <button onclick="saveProfile()">Save Profile</button>
</div>

<div class="card">
    <h3>Business Information</h3>
    <input type="text" id="businessName" placeholder="Business Name">
    <textarea id="businessDesc" rows="3" placeholder="Business Description"></textarea>
    <button onclick="saveBusiness()">Save Business Info</button>
</div>

<div class="card">
    <h3>Account Info</h3>
    <p id="signupDate"></p>
</div>

<div class="card">
    <h3>Activity Log</h3>
    <div id="activityLog"></div>
</div>

<button class="logout-btn" onclick="logout()">Logout</button>

<script>
const currentUser = localStorage.getItem("currentUser");
const users = JSON.parse(localStorage.getItem("users")) || [];

if(!currentUser){
    window.location.href = "index.html";
}

let user = users.find(u => u.email === currentUser);

if(!user){
    window.location.href = "index.html";
}

if(user.role === "admin"){
    window.location.href = "admin.html";
}

document.getElementById("nameInput").value = user.name;
document.getElementById("emailInput").value = user.email;
document.getElementById("signupDate").innerText =
    "Account Created: " + new Date(user.signupDate).toLocaleString();

if(user.business){
    document.getElementById("businessName").value = user.business.name || "";
    document.getElementById("businessDesc").value = user.business.desc || "";
}

loadActivity();

function saveProfile(){
    user.name = document.getElementById("nameInput").value;

    updateUser();
    alert("Profile Updated");
}

function saveBusiness(){
    user.business = {
        name: document.getElementById("businessName").value,
        desc: document.getElementById("businessDesc").value
    };

    addActivity("Updated Business Information");
    updateUser();
    alert("Business Info Saved");
}

function updateUser(){
    const index = users.findIndex(u => u.email === user.email);
    users[index] = user;
    localStorage.setItem("users", JSON.stringify(users));
}

function addActivity(action){
    if(!user.activity) user.activity = [];

    user.activity.push({
        action: action,
        timestamp: new Date().toISOString(),
        date: new Date().toLocaleString()
    });

    updateUser();
    loadActivity();
}

function loadActivity(){
    const log = document.getElementById("activityLog");
    log.innerHTML = "";

    if(!user.activity || user.activity.length === 0){
        log.innerHTML = "No activity yet.";
        return;
    }

    user.activity.slice().reverse().forEach(item=>{
        const div = document.createElement("div");
        div.className = "activity-item";
        div.innerHTML = `<strong>${item.action}</strong><br><small>${item.date}</small>`;
        log.appendChild(div);
    });
}

function logout(){
    localStorage.removeItem("currentUser");
    window.location.href = "index.html";
}
</script>

</body>
</html>
